@page "/login/{target:alpha}"
@using ComwellApp.Services
@using ComwellApp.Services.Login
@using Shared
@inject NavigationManager navManager
@inject ILoginService loginService
<PageTitle>Log ind</PageTitle>

<div class="login-page-background">
    <div class="login-container">
        <h3>Log ind</h3>

        <div class="form-floating-group">
            <InputText id="email" class="form-control floating-input" @bind-Value="Email" placeholder=" "/>
            <label for="email">Email</label>
        </div>

        <div class="form-floating-group">
            <InputText id="adgangskode" type="password" class="form-control floating-input" @bind-Value="Adgangskode" placeholder=" "/>
            <label for="adgangskode">Adgangskode</label>
        </div>
        
        <div class="form-group mt-2">
            <button class="btn btn-primary" @onclick="OnClickLogin">Log ind</button>
        </div>
        @if (!string.IsNullOrEmpty(errorText))
        {
            <div class="error-message">
                <span class="error-icon">⚠️</span>
                <span class="error-text">@errorText</span>
            </div>
        }
    </div>
</div>
@code {
    string Email = "";
    string Adgangskode = "";
    string errorText = "";

    [Parameter] public string target { get; set; }

    private async Task OnClickLogin()
    {
        var succes = await loginService.Login(Email, Adgangskode);
        if (!succes)
        {
            errorText = "Forkert email eller adgangskode, prøv igen";
        }
        else
        {
            navManager.NavigateTo(target, forceLoad: true);
        }
    }
}