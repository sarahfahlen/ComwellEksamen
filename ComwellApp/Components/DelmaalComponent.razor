@using Shared
<div class="delmaal-container">
    @foreach (var delmaal in maal.ListDelmaal)
    {
        <div class="delmaal">
            @if (BrugerRolle == "Køkkenchef" || BrugerRolle == "Admin")
            {
                <p>
                    <button @onclick="() => OnRedigerDelmaal.InvokeAsync(delmaal)">✏️ Rediger</button>
                </p>
            }
            <h4 class="delmaal-overskrift">@delmaal.Titel</h4>
            <p>Beskrivelse: @delmaal.Beskrivelse</p>
            <p>Type: @delmaal.DelmaalType</p>
            <p>Ansvarlig: @delmaal.Ansvarlig</p>
            <p>
                Deadline: @(delmaal.Deadline != null
                              ? delmaal.Deadline?.ToString("dd/MM-yyyy")
                              : delmaal.DeadlineKommentar)
            </p>
            <p> Kommentar:
                <button class="kommentar-knap" @onclick="() => OnInputDelmaal.InvokeAsync(delmaal.DelmaalId)">
                    Se kommentar
                </button>
            </p>
            @if (delmaal.Status && !string.IsNullOrWhiteSpace(delmaal.StatusLog))
            {
                <p class="status-log">@delmaal.StatusLog</p>
            }

            <div class="status-badge @(delmaal.Status ? "gennemført" : "ikke-gennemført")"
                 @onclick="() => OnToggleStatus.InvokeAsync(delmaal)">
                @(delmaal.Status ? "Gennemført" : "Ikke gennemført")
            </div>
            @if (delmaal.ListOpgaver != null && delmaal.ListOpgaver.Any())
            {
                <div class="opgave-liste">
                    <h5>Opgaver</h5>
                    <ul>
                        @foreach (var opg in delmaal.ListOpgaver)
                        {
                            <li>
                                <strong>@opg.OpgaveNavn:</strong> @opg.OpgaveDetaljer
                                @if (opg.OpgaveGennemfoert)
                                {
                                    <span class="badge badge-success">✔️</span>
                                }
                                else
                                {
                                    <span class="badge badge-warning">❌</span>
                                }
                            </li>
                        }
                    </ul>
                </div>
            }

        </div>
    }
    
</div>
@code {
    [Parameter] public required Maal maal { get; set; }
    
    //Sender det valgte delmåls ID tilbage til parent komponenten (Elevplan side), så vi kan bruge åbenKommentar
    [Parameter] public required EventCallback<int> OnInputDelmaal { get; set; }
    
    //Samme som ovenfor, men så vi kan bruge ToggleStatus for hvert delmål
    [Parameter] public EventCallback<Delmaal> OnToggleStatus { get; set; }
    
    //Bruges til at håndtere visningen af redigerknap
    [Parameter] public string? BrugerRolle { get; set; }

    //Bruges til at sende delmålet til parent komponenten, så vi kan redigere i det
    [Parameter] public EventCallback<Delmaal> OnRedigerDelmaal { get; set; }





}